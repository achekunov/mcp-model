
classes:
  - system.linux.system.haveged
 #- system.glusterfs.server.volume.salt
  - system.glusterfs.client.cluster
  - system.glusterfs.client.volume.aptly
  - system.glusterfs.client.volume.gerrit
  - system.glusterfs.client.volume.jenkins
  - system.glusterfs.client.volume.mysql
  - system.glusterfs.client.volume.registry
 #- system.glusterfs.client.volume.salt
  # Docker
  - system.docker.host
  # Docker services
  - system.docker.swarm.service.aptly
  - system.docker.swarm.service.docker
  - system.docker.swarm.service.gerrit
  - system.docker.swarm.service.jenkins
  - system.docker.swarm.service.mysql
  # - system.docker.swarm.service.openldap
  - system.docker.swarm.service.visualizer

  # Keepalived
  - system.keepalived.cluster.instance.cicd_control_vip

  # HAProxy
  - system.salt.minion.cert.proxy.cicd
  - system.haproxy.proxy.single
  - system.haproxy.proxy.listen.cicd.aptly
  - system.haproxy.proxy.listen.cicd.gerrit
  - system.haproxy.proxy.listen.cicd.jenkins
  - system.haproxy.proxy.listen.docker.registry
  - system.haproxy.proxy.listen.docker.visualizer
  - system.haproxy.proxy.listen.mysql
  - system.haproxy.proxy.listen.stats
  - cluster.my

parameters:
  _param:
    cluster_node01_name: ${_param:cicd_control_node01_hostname}
    cluster_node01_address: ${_param:cicd_control_node01_address}
    cluster_node02_name: ${_param:cicd_control_node02_hostname}
    cluster_node02_address: ${_param:cicd_control_node02_address}
    cluster_node03_name: ${_param:cicd_control_node03_hostname}
    cluster_node03_address: ${_param:cicd_control_node03_address}
    keepalived_vip_virtual_router_id: 180
    keepalived_vip_password: password
    keepalived_vip_interface: ens3
    cluster_vip_address: ${_param:control_vip_address}
    control_vip_address: ${_param:cicd_control_address}
    cluster_public_host: ${_param:control_vip_address}
    salt_api_password: password
    # Docker images and versions
    docker_registry_http_secret: 66EkJrTBY32i2Qwq
    # CI/CD service databases
    mysql_admin_password: mbp3mOEQWRwXICpY
    mysql_gerrit_password: gImJmZEDqPUaZnk1
    admin_email: root@localhost
    glusterfs_service_host: ${_param:infra_kvm_address} 
    aptly_gpg_passphrase: gImJmZEDqPUaZnk1

    # Proxy
    cluster_ssl_certificate:
      enabled: true
      pem_file: /etc/haproxy/ssl/${_param:cluster_public_host}-all.pem
    haproxy_bind_address: ${_param:cluster_vip_address}
    haproxy_mysql_source_port: 13306
    salt_minion_ca_host: ${_param:infra_config_hostname}.${_param:cluster_domain}

    # Jenkins
    jenkins_slave_user: admin
    jenkins_client_user: admin
    jenkins_admin_password: Hym9Os1NWzhVrxiM
    jenkins_slave_password: ${_param:jenkins_admin_password}
    jenkins_client_password: ${_param:jenkins_admin_password}
    jenkins_admin_email: ${_param:admin_email}
    jenkins_admin_public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDVvxGYa8OW8Tao0HE1dsWJxwznNn6sw9mNEHXq8vYKd92vmwagmTiEYhN7wD02qX4a04nupyfqMJ73fR5xJk0z1EmyBk/dx9JClLgOsaMdr1Px+3aWDiAXpoa24s8PvA2n4UVz38/vMMjK1aixH5GOBStGaSh++bD2Ha1WT713bmpecLB61HZJmZmFqzlvwQS7A55oZiO58YEly6qEBJG2CVCmVks+fxGQ//dSpsmG6XEIpL7tcJ+bElhL6+0Ppd9cdAnydsBIw3TD5TTWudf4hy/h2IUOTpi/xr+WfZCWxvVHL36h6Is/TyYHzd5hQbgE9ElqAkgzfqCG6Ocucv4P
    jenkins_admin_private_key: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEowIBAAKCAQEA1b8RmGvDlvE2qNBxNXbFiccM5zZ+rMPZjRB16vL2Cnfdr5sG
      oJk4hGITe8A9Nql+GtOJ7qcn6jCe930ecSZNM9RJsgZP3cfSQpS4DrGjHa9T8ft2
      lg4gF6aGtuLPD7wNp+FFc9/P7zDIytWosR+RjgUrRmkofvmw9h2tVk+9d25qXnCw
      etR2SZmZhas5b8EEuwOeaGYjufGBJcuqhASRtglQplZLPn8RkP/3UqbJhulxCKS+
      7XCfmxJYS+vtD6XfXHQJ8nbASMN0w+U01rnX+Icv4diFDk6Yv8a/ln2Qlsb1Ry9+
      oeiLP08mB83eYUG4BPRJagJIM36ghujnLnL+DwIDAQABAoIBAF1g/rffBHCx6pYv
      kfWwcLYzTpDIPukNGsLE2S8Oe6yxFxk7mdaZeZZkHmzm3BdATsY7ejvXrNlj6l7m
      u2DlQb8N1DBBD60tOc86l3pb4o36ZasGl5UQkLakWqAVUC5oknKwOJ5ZvcaaQm5S
      j0LqLrWjzncRQ87NGKE879gQOA6vUscBaIR7AbOcCFtpAmmbqNfCm4Ec6E9KLbFJ
      cin3l0VYOYN+z4d6NwNWbH1kZPSWIm7/YN+T6eyAgharSU8z+ZetKC5pe9iYrXoC
      wCflGLMSEYiE1scI+2J48SyBBucQD/Hob71ax3CKDtMAaf0VIR4uxAzHOZT7B5jz
      mdcy7rECgYEA6wGZMDZk24fZUecjEZ38Dw2Gl5R4fj2SAgpdOgjgPWvX/wAntlB5
      ys3qLQGwIsveDUj5nyTqCc7WyLkxPDZjpThmkv0OkjNJNNoE0YJvY593sZbufYZp
      GdeDpquexx2LifHFNVh7kIGkFgdE6jYR+SbNpOQ49CONLaJ177fo1scCgYEA6NdG
      LnIqk1tZHVvDcoBErIrmMUr4SGnZ4s7dhdRMYmimw9LnWsynXGd1iTBmbJE5luap
      1CzysMwF7N/oX1W6khdUzx2FWCuO2ZLW3S0iZpzLGrv7tng5c4nrPiLnaWpvObWa
      Vxytsuc22TMxz7gjEunrN2EpAbFR+8RP5D2stnkCgYBobHhmTPU5+z5cv2j8zgeP
      pMH2ntl/ttonH/XW8NS7Vi1POQFsaIwFysPQpdxfSdlsa83Hon6ARzF3VZsEF2Ll
      qo8hp2KPIkzYODxF4ECgst5bwiZNDqmq+vGb4MyXy5AShqTLlHqrdn+z7hz4OXh5
      Dn34VBTenuF/sp3XHBBRRwKBgD7fysrF92s9Mo4z9k4YBvNUup468VqUgsq1M6ps
      zoeQXN/qNqEVPGg+Y8W89RuCB7wQ43ExBgPpw/vX5qa/vpauiC85eIV7laJ4/V5S
      TsTIuCuq8WivhEwHxSdNQ5H6tLgvqtK1Is55kx0Jrvy5a3czBVo5+VnEqS/ELhKi
      +N15AoGBALwbGLkzRb2COPuTJ8g6Px10qI7ueGrlL/0CDB4eYRvj2k4ACVHzZJf9
      pLAfThIu0kHfgUAnmmapC9jAN6oNaROfDw7XZa3QzwtSEDtYS5uswbTbjSBoLyV7
      reNbcrX4jyK/B+pOH/TrCNSqCY8XFKUTdPiTWzkF7uLeVMaC+ndO
      -----END RSA PRIVATE KEY-----
    # Jobs params
    jenkins_gerrit_url: ssh://admin@${_param:gerrit_public_host}:${_param:haproxy_gerrit_ssh_bind_port}
    jenkins_aptly_api_url: http://${_param:haproxy_aptly_api_bind_host}:${_param:haproxy_aptly_api_bind_port}
    jenkins_aptly_url: http://${_param:haproxy_aptly_public_bind_host}:${_param:haproxy_aptly_public_bind_port}
    # Gerrit

    gerrit_admin_email: ${_param:admin_email}
    gerrit_public_host: ${_param:control_vip_address}
    gerrit_admin_public_key: ${_param:jenkins_admin_public_key}
    gerrit_admin_private_key: ${_param:jenkins_admin_private_key}
    gerrit_admin_password: pgZ0QfAhnsHgdiwK
    gerrit_auth_type: DEVELOPMENT_BECOME_ANY_ACCOUNT

  linux:
    system:
      package:
        ca-certificates-java:
          version: latest
    network:
      interface:
        ens3: ${_param:linux_single_interface}
